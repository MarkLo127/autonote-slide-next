{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/yaolo/Desktop/autonote-slide-next/frontend/src/lib/generateAnalysisPdf.ts"],"sourcesContent":["'use client';\n\nimport { PDFDocument } from \"pdf-lib\";\n\nexport type PdfPageSummary = {\n  page_number: number;\n  classification: string;\n  bullets: string[];\n  keywords: string[];\n  skipped: boolean;\n  skip_reason?: string | null;\n};\n\nexport type PdfGlobalSummary = {\n  bullets: string[];\n  expansions: {\n    key_conclusions: string;\n    core_data: string;\n    risks_and_actions: string;\n  };\n};\n\nexport type PdfAnalysisPayload = {\n  documentTitle: string;\n  languageLabel?: string | null;\n  totalPages: number;\n  globalSummary: PdfGlobalSummary;\n  aggregatedKeywords: string[];\n  pageSummaries: PdfPageSummary[];\n  wordcloudUrl?: string | null;\n  mindmapImageUrl?: string | null;\n  fontUrl?: string | null;\n};\n\nconst PDF_FONT_FAMILY = \"NotoSansTCPdf\";\nconst FONT_STACK = `${PDF_FONT_FAMILY}, 'Noto Sans TC', 'PingFang TC', 'Microsoft JhengHei', 'Heiti TC', sans-serif`;\nconst PAGE_WIDTH = 1190;\nconst PAGE_HEIGHT = 1684;\nconst PDF_PAGE_WIDTH = 595.28; // A4 width in points\nconst PDF_PAGE_HEIGHT = 841.89; // A4 height in points\nconst MARGIN_X = 80;\nconst MARGIN_TOP = 80;\nconst MARGIN_BOTTOM = 100;\nconst SECTION_GAP = 32;\nconst HEADING_COLOR = \"#111827\";\nconst BODY_COLOR = \"#1f2937\";\nconst MUTED_COLOR = \"#6b7280\";\n\nlet fontLoadPromise: Promise<void> | null = null;\nlet pdfFontLoaded = false;\n\nconst buildFont = (size: number, weight = 400) => {\n  const weightPart = weight === 400 ? '' : `${weight} `;\n  return `${weightPart}${size}px ${FONT_STACK}`;\n};\n\nconst ensurePrimaryFont = async (fontUrl?: string | null) => {\n  if (pdfFontLoaded || !fontUrl) return;\n  if (typeof document === 'undefined' || typeof FontFace === 'undefined' || !('fonts' in document)) return;\n\n  if (!fontLoadPromise) {\n    fontLoadPromise = (async () => {\n      try {\n        const fontFace = new FontFace(\n          PDF_FONT_FAMILY,\n          `url(${fontUrl})`,\n          { weight: '100 900' },\n        );\n        const loaded = await fontFace.load();\n        document.fonts.add(loaded);\n        await document.fonts.ready;\n        pdfFontLoaded = true;\n      } catch (err) {\n        pdfFontLoaded = false;\n        console.warn('PDF 字型載入失敗，將改用系統字型', err);\n      }\n    })();\n  }\n\n  try {\n    await fontLoadPromise;\n  } catch {\n    fontLoadPromise = null;\n  }\n\n  if (!pdfFontLoaded) {\n    fontLoadPromise = null;\n  }\n};\n\nconst CLASSIFICATION_LABEL: Record<string, string> = {\n  normal: \"一般內容\",\n  toc: \"目錄頁\",\n  pure_image: \"純圖片\",\n  blank: \"空白/水印\",\n  cover: \"封面\",\n};\n\ntype PageContext = {\n  canvas: HTMLCanvasElement;\n  ctx: CanvasRenderingContext2D;\n  cursorY: number;\n  pageNumber: number;\n};\n\nconst createPage = (pageNumber: number): PageContext => {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = PAGE_WIDTH;\n  canvas.height = PAGE_HEIGHT;\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    throw new Error(\"無法建立畫布內容 (CanvasRenderingContext2D)\");\n  }\n\n  ctx.fillStyle = \"#ffffff\";\n  ctx.fillRect(0, 0, PAGE_WIDTH, PAGE_HEIGHT);\n  ctx.textBaseline = \"top\";\n  ctx.fillStyle = BODY_COLOR;\n  ctx.font = buildFont(16);\n\n  return {\n    canvas,\n    ctx,\n    cursorY: MARGIN_TOP,\n    pageNumber,\n  };\n};\n\nconst drawFooter = (ctx: CanvasRenderingContext2D, pageNumber: number) => {\n  ctx.save();\n  ctx.fillStyle = MUTED_COLOR;\n  ctx.font = buildFont(14);\n  ctx.fillText(\n    `第 ${pageNumber} 頁`,\n    PAGE_WIDTH - MARGIN_X - ctx.measureText(`第 ${pageNumber} 頁`).width,\n    PAGE_HEIGHT - MARGIN_BOTTOM + 36,\n  );\n  ctx.restore();\n};\n\nconst wrapLine = (\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  maxWidth: number,\n): string[] => {\n  if (!text) return [\"\"];\n  const sanitized = text.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\");\n  const lines: string[] = [];\n\n  for (const rawLine of sanitized.split(\"\\n\")) {\n    let current = \"\";\n    for (const char of rawLine) {\n      const testLine = current + char;\n      const width = ctx.measureText(testLine).width;\n      if (width <= maxWidth || current.length === 0) {\n        current = testLine;\n      } else {\n        lines.push(current);\n        current = char === \" \" ? \"\" : char;\n      }\n    }\n    if (current) {\n      lines.push(current);\n    } else if (rawLine.length === 0) {\n      lines.push(\"\");\n    }\n  }\n  return lines;\n};\n\nconst drawParagraph = (\n  context: PageContext,\n  text: string,\n  options?: { font?: string; color?: string; lineHeight?: number; gapAfter?: number },\n  ensureSpace?: () => void,\n) => {\n  const font = options?.font ?? buildFont(16);\n  const color = options?.color ?? BODY_COLOR;\n  const lineHeight = options?.lineHeight ?? 26;\n  const gapAfter = options?.gapAfter ?? 12;\n\n  let ctx = context.ctx;\n  ctx.save();\n  ctx.font = font;\n  ctx.fillStyle = color;\n\n  const lines = wrapLine(ctx, text, PAGE_WIDTH - MARGIN_X * 2);\n  for (const line of lines) {\n    if (context.cursorY + lineHeight > PAGE_HEIGHT - MARGIN_BOTTOM) {\n      ctx.restore();\n      ensureSpace?.();\n      ctx = context.ctx;\n      ctx.save();\n      ctx.font = font;\n      ctx.fillStyle = color;\n    }\n    ctx.fillText(line, MARGIN_X, context.cursorY);\n    context.cursorY += lineHeight;\n  }\n  context.cursorY += gapAfter;\n  ctx.restore();\n};\n\nconst drawBulletList = (\n  context: PageContext,\n  bullets: string[],\n  options?: { lineHeight?: number; bulletSpacing?: number },\n  ensureSpace?: () => void,\n) => {\n  const lineHeight = options?.lineHeight ?? 26;\n  const bulletSpacing = options?.bulletSpacing ?? 10;\n  const font = buildFont(16);\n\n  let ctx = context.ctx;\n  ctx.save();\n  ctx.font = font;\n  ctx.fillStyle = BODY_COLOR;\n\n  for (const bullet of bullets) {\n    const lines = wrapLine(ctx, bullet, PAGE_WIDTH - MARGIN_X * 2 - 24);\n\n    const bulletHeight = Math.max(lineHeight, lines.length * lineHeight);\n    if (context.cursorY + bulletHeight > PAGE_HEIGHT - MARGIN_BOTTOM) {\n      ctx.restore();\n      ensureSpace?.();\n      ctx = context.ctx;\n      ctx.save();\n      ctx.font = font;\n      ctx.fillStyle = BODY_COLOR;\n    }\n\n    const bulletX = MARGIN_X;\n    const textX = bulletX + 24;\n    ctx.fillText(\"•\", bulletX, context.cursorY);\n    let lineCursor = context.cursorY;\n    for (const line of lines) {\n      ctx.fillText(line, textX, lineCursor);\n      lineCursor += lineHeight;\n    }\n    context.cursorY = Math.max(context.cursorY + bulletHeight, lineCursor);\n    context.cursorY += bulletSpacing;\n  }\n\n  ctx.restore();\n};\n\nconst canvasToPngBytes = async (canvas: HTMLCanvasElement): Promise<Uint8Array> =>\n  new Promise((resolve, reject) => {\n    canvas.toBlob(\n      async (blob) => {\n        try {\n          if (!blob) {\n            reject(new Error(\"無法將畫布轉換為 PNG\"));\n            return;\n          }\n          const buffer = await blob.arrayBuffer();\n          resolve(new Uint8Array(buffer));\n        } catch (err) {\n          reject(err);\n        }\n      },\n      \"image/png\",\n      1,\n    );\n  });\n\nconst loadImage = async (url: string): Promise<HTMLImageElement> =>\n  new Promise((resolve, reject) => {\n    const image = new Image();\n    image.crossOrigin = \"anonymous\";\n    image.onload = () => resolve(image);\n    image.onerror = () => reject(new Error(`無法載入圖像：${url}`));\n    image.src = url;\n  });\n\nexport const generateAnalysisPdf = async (payload: PdfAnalysisPayload): Promise<Uint8Array> => {\n  await ensurePrimaryFont(payload.fontUrl);\n\n  const pages: HTMLCanvasElement[] = [];\n  const current = createPage(1);\n\n  const commitPage = () => {\n    drawFooter(current.ctx, current.pageNumber);\n    pages.push(current.canvas);\n    const next = createPage(current.pageNumber + 1);\n    current.canvas = next.canvas;\n    current.ctx = next.ctx;\n    current.cursorY = next.cursorY;\n    current.pageNumber = next.pageNumber;\n  };\n\n  const ensureSpace = (minHeight = 120) => {\n    if (current.cursorY + minHeight > PAGE_HEIGHT - MARGIN_BOTTOM) {\n      commitPage();\n    }\n  };\n\n  // 報告抬頭\n  current.ctx.save();\n  current.ctx.fillStyle = HEADING_COLOR;\n  current.ctx.font = buildFont(32, 700);\n  const title = \"分析報告\";\n  current.ctx.fillText(title, MARGIN_X, current.cursorY);\n  current.cursorY += 46;\n\n  current.ctx.font = buildFont(24, 600);\n  current.ctx.fillText(payload.documentTitle || \"未命名檔案\", MARGIN_X, current.cursorY);\n  current.cursorY += 38;\n\n  current.ctx.restore();\n\n  current.ctx.save();\n  current.ctx.font = buildFont(15);\n  current.ctx.fillStyle = MUTED_COLOR;\n  const metaPieces = [\n    payload.languageLabel ? `語言：${payload.languageLabel}` : null,\n    `總頁數：${payload.totalPages}`,\n  ].filter(Boolean) as string[];\n  current.ctx.fillText(metaPieces.join(\"  •  \"), MARGIN_X, current.cursorY);\n  current.ctx.restore();\n  current.cursorY += 40;\n\n  const drawSectionHeading = (text: string) => {\n    ensureSpace(80);\n    current.ctx.save();\n    current.ctx.fillStyle = HEADING_COLOR;\n    current.ctx.font = buildFont(22, 600);\n    current.ctx.fillText(text, MARGIN_X, current.cursorY);\n    current.ctx.restore();\n    current.cursorY += 34;\n  };\n\n  const drawSubHeading = (text: string) => {\n    ensureSpace(50);\n    current.ctx.save();\n    current.ctx.fillStyle = HEADING_COLOR;\n    current.ctx.font = buildFont(18, 600);\n    current.ctx.fillText(text, MARGIN_X, current.cursorY);\n    current.ctx.restore();\n    current.cursorY += 28;\n  };\n\n  // 全局摘要\n  drawSectionHeading(\"全局摘要\");\n  if (payload.globalSummary.bullets.length) {\n    drawBulletList(current, payload.globalSummary.bullets, undefined, () => {\n      commitPage();\n      drawSectionHeading(\"全局摘要\");\n    });\n  } else {\n    drawParagraph(current, \"尚未提供全局摘要。\", { color: MUTED_COLOR });\n  }\n  current.cursorY += SECTION_GAP;\n\n  // 延伸說明\n  drawSectionHeading(\"延伸說明\");\n  drawSubHeading(\"關鍵結論\");\n  drawParagraph(\n    current,\n    payload.globalSummary.expansions.key_conclusions || \"暫無資料\",\n    { gapAfter: 16 },\n    () => {\n      commitPage();\n      drawSectionHeading(\"延伸說明\");\n      drawSubHeading(\"關鍵結論\");\n    },\n  );\n\n  drawSubHeading(\"核心資料\");\n  drawParagraph(\n    current,\n    payload.globalSummary.expansions.core_data || \"暫無資料\",\n    { gapAfter: 16 },\n    () => {\n      commitPage();\n      drawSectionHeading(\"延伸說明\");\n      drawSubHeading(\"核心資料\");\n    },\n  );\n\n  drawSubHeading(\"風險與建議\");\n  drawParagraph(\n    current,\n    payload.globalSummary.expansions.risks_and_actions || \"暫無資料\",\n    undefined,\n    () => {\n      commitPage();\n      drawSectionHeading(\"延伸說明\");\n      drawSubHeading(\"風險與建議\");\n    },\n  );\n\n  current.cursorY += SECTION_GAP;\n\n  // 關鍵字\n  drawSectionHeading(\"整體關鍵字\");\n  if (payload.aggregatedKeywords.length) {\n    const keywordText = payload.aggregatedKeywords.join(\"，\");\n    drawParagraph(\n      current,\n      keywordText,\n      {\n        gapAfter: 0,\n      },\n      () => {\n        commitPage();\n        drawSectionHeading(\"整體關鍵字\");\n      },\n    );\n  } else {\n    drawParagraph(current, \"暫無整體關鍵字資料。\", { color: MUTED_COLOR });\n  }\n\n  commitPage();\n\n  // 逐頁摘要\n  const drawPageSummaryHeading = () => {\n    current.ctx.save();\n    current.ctx.fillStyle = HEADING_COLOR;\n    current.ctx.font = buildFont(24, 600);\n    current.ctx.fillText(\"逐頁重點摘要\", MARGIN_X, current.cursorY);\n    current.ctx.restore();\n    current.cursorY += 38;\n  };\n\n  drawPageSummaryHeading();\n\n  for (const summary of payload.pageSummaries) {\n    ensureSpace(160);\n    const classificationLabel =\n      CLASSIFICATION_LABEL[summary.classification] ?? summary.classification;\n\n    current.ctx.save();\n    current.ctx.fillStyle = HEADING_COLOR;\n    current.ctx.font = buildFont(18, 600);\n    current.ctx.fillText(`第 ${summary.page_number} 頁`, MARGIN_X, current.cursorY);\n    const meta = summary.skipped && summary.skip_reason ? \"（已跳過）\" : classificationLabel;\n    current.ctx.fillStyle = MUTED_COLOR;\n    current.ctx.font = buildFont(15);\n    const metaText = ` ${meta}`;\n    current.ctx.fillText(metaText, MARGIN_X + current.ctx.measureText(`第 ${summary.page_number} 頁`).width + 6, current.cursorY + 2);\n    current.ctx.restore();\n    current.cursorY += 28;\n\n    if (summary.bullets.length) {\n      drawBulletList(current, summary.bullets, undefined, () => {\n        commitPage();\n        drawPageSummaryHeading();\n        current.ctx.save();\n        current.ctx.fillStyle = HEADING_COLOR;\n        current.ctx.font = buildFont(18, 600);\n        current.ctx.fillText(`第 ${summary.page_number} 頁`, MARGIN_X, current.cursorY);\n        const newMeta = summary.skipped && summary.skip_reason ? \"（已跳過）\" : classificationLabel;\n        current.ctx.fillStyle = MUTED_COLOR;\n        current.ctx.font = buildFont(15);\n        current.ctx.fillText(\n          ` ${newMeta}`,\n          MARGIN_X + current.ctx.measureText(`第 ${summary.page_number} 頁`).width + 6,\n          current.cursorY + 2,\n        );\n        current.ctx.restore();\n        current.cursorY += 28;\n      });\n    } else {\n      drawParagraph(\n        current,\n        \"本頁無摘要資料。\",\n        { color: MUTED_COLOR, gapAfter: 10 },\n        () => {\n          commitPage();\n          drawPageSummaryHeading();\n          current.ctx.save();\n          current.ctx.fillStyle = HEADING_COLOR;\n          current.ctx.font = buildFont(18, 600);\n          current.ctx.fillText(`第 ${summary.page_number} 頁`, MARGIN_X, current.cursorY);\n          current.ctx.restore();\n          current.cursorY += 28;\n        },\n      );\n    }\n\n    if (summary.keywords.length) {\n      const keywordLine = summary.keywords.join(\"、\");\n      drawParagraph(\n        current,\n        `關鍵字：${keywordLine}`,\n        { color: MUTED_COLOR, gapAfter: 18 },\n        () => {\n          commitPage();\n          drawPageSummaryHeading();\n          current.ctx.save();\n          current.ctx.fillStyle = HEADING_COLOR;\n          current.ctx.font = buildFont(18, 600);\n          current.ctx.fillText(`第 ${summary.page_number} 頁`, MARGIN_X, current.cursorY);\n          current.ctx.restore();\n          current.cursorY += 28;\n        },\n      );\n    }\n\n    if (summary.skipped && summary.skip_reason) {\n      drawParagraph(\n        current,\n        `跳過原因：${summary.skip_reason}`,\n        { color: MUTED_COLOR, gapAfter: 28 },\n        () => {\n          commitPage();\n          drawPageSummaryHeading();\n          current.ctx.save();\n          current.ctx.fillStyle = HEADING_COLOR;\n          current.ctx.font = buildFont(18, 600);\n          current.ctx.fillText(`第 ${summary.page_number} 頁`, MARGIN_X, current.cursorY);\n          current.ctx.restore();\n          current.cursorY += 28;\n        },\n      );\n    } else {\n      current.cursorY += 18;\n    }\n  }\n\n  commitPage();\n\n  const drawImagePage = async (title: string, imageUrl?: string | null) => {\n    const needsNewPage = current.cursorY !== MARGIN_TOP;\n    if (needsNewPage) {\n      commitPage();\n    }\n\n    current.ctx.save();\n    current.ctx.fillStyle = HEADING_COLOR;\n    current.ctx.font = buildFont(26, 600);\n    current.ctx.fillText(title, MARGIN_X, current.cursorY);\n    current.ctx.restore();\n    current.cursorY += 40;\n\n    if (imageUrl) {\n      try {\n        const image = await loadImage(imageUrl);\n        const availableWidth = PAGE_WIDTH - MARGIN_X * 2;\n        const availableHeight = PAGE_HEIGHT - MARGIN_TOP - MARGIN_BOTTOM - 80;\n        const scale = Math.min(availableWidth / image.width, availableHeight / image.height, 1);\n        const drawWidth = image.width * scale;\n        const drawHeight = image.height * scale;\n        const offsetX = MARGIN_X + (availableWidth - drawWidth) / 2;\n        current.ctx.drawImage(image, offsetX, current.cursorY, drawWidth, drawHeight);\n      } catch (err) {\n        drawParagraph(current, `圖像載入失敗：${(err as Error).message}`, { color: MUTED_COLOR });\n      }\n    } else {\n      drawParagraph(current, \"尚未取得圖像資料。\", { color: MUTED_COLOR });\n    }\n\n    commitPage();\n  };\n\n  await drawImagePage(\"文字雲\", payload.wordcloudUrl);\n  await drawImagePage(\"心智圖\", payload.mindmapImageUrl);\n\n  const pdfDoc = await PDFDocument.create();\n  for (const canvas of pages) {\n    const pngBytes = await canvasToPngBytes(canvas);\n    const pngImage = await pdfDoc.embedPng(pngBytes);\n    const page = pdfDoc.addPage([PDF_PAGE_WIDTH, PDF_PAGE_HEIGHT]);\n    const scale = PDF_PAGE_WIDTH / PAGE_WIDTH;\n    const scaled = pngImage.scale(scale);\n    page.drawImage(pngImage, {\n      x: 0,\n      y: PDF_PAGE_HEIGHT - scaled.height,\n      width: scaled.width,\n      height: scaled.height,\n    });\n  }\n\n  return pdfDoc.save();\n};\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 461, "column": 0}, "map": {"version":3,"sources":["file:///Users/yaolo/Desktop/autonote-slide-next/frontend/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  useCallback,\n  useEffect,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n  type DragEvent,\n} from \"react\";\nimport Image from \"next/image\";\n\nimport { generateAnalysisPdf } from \"@/lib/generateAnalysisPdf\";\n\ntype Paragraph = {\n  index: number;\n  text: string;\n  start_char: number;\n  end_char: number;\n};\n\ntype KeywordItem = {\n  paragraph_index: number;\n  keywords: string[];\n};\n\ntype PageSummary = {\n  page_number: number;\n  classification: string;\n  bullets: string[];\n  keywords: string[];\n  skipped: boolean;\n  skip_reason?: string | null;\n};\n\ntype GlobalSummaryExpansions = {\n  key_conclusions: string;\n  core_data: string;\n  risks_and_actions: string;\n};\n\ntype GlobalSummary = {\n  bullets: string[];\n  expansions: GlobalSummaryExpansions;\n};\n\ntype AnalyzeResponse = {\n  language: string;\n  total_pages: number;\n  page_summaries: PageSummary[];\n  global_summary: GlobalSummary;\n  system_prompt?: string | null;\n  wordcloud_image_url: string | null;\n};\n\ntype MindmapResponse = {\n  language: string;\n  paragraphs: Paragraph[];\n  paragraph_keywords: KeywordItem[];\n  doc_title: string;\n  mindmap_mermaid: string;\n  mindmap_file_url: string | null;\n  mindmap_image_url: string | null;\n  mindmap_image_file: string | null;\n  source_upload_url?: string | null;\n};\n\ntype FilePreviewKind = \"none\" | \"pdf\" | \"text\" | \"image\" | \"generic\";\n\nconst rawBackendOrigin =\n  process.env.NEXT_PUBLIC_BACKEND_URL ??\n  process.env.NEXT_PUBLIC_API_BASE_URL ??\n  \"http://localhost:8000\";\nconst sanitizeBase = (base: string) => base.replace(/\\/$/, \"\");\n\nconst resolveBrowserBackendBase = (base: string) => {\n  if (typeof window === \"undefined\") return base;\n  try {\n    const url = new URL(base);\n    if (url.hostname === \"backend\") {\n      const port = url.port || \"8000\";\n      return `${window.location.protocol}//${window.location.hostname}${port ? `:${port}` : \"\"}`;\n    }\n    if (url.hostname === \"0.0.0.0\") {\n      const port = url.port || \"8000\";\n      return `${window.location.protocol}//${window.location.hostname}${port ? `:${port}` : \"\"}`;\n    }\n  } catch (err) {\n    console.warn(\"解析後端位址失敗，將使用預設值\", err);\n    return base;\n  }\n  return base;\n};\n\nconst INITIAL_BACKEND_BASE = sanitizeBase(rawBackendOrigin);\nconst DEFAULT_LLM_BASE_URL = \"https://api.openai.com/v1\";\n\nconst normalizeOptionalUrl = (url: string) =>\n  url ? url.trim().replace(/\\/$/, \"\") : \"\";\n\nconst fileTypes = [\n  { label: \"PDF\", color: \"text-rose-500\" },\n  { label: \"PPT\", color: \"text-orange-500\" },\n  { label: \"PPTX\", color: \"text-orange-400\" },\n  { label: \"DOC\", color: \"text-blue-500\" },\n  { label: \"DOCX\", color: \"text-blue-400\" },\n  { label: \"MD\", color: \"text-emerald-500\" },\n  { label: \"TXT\", color: \"text-slate-500\" },\n];\n\nconst formatBytes = (bytes: number) => {\n  if (bytes === 0) return \"0 B\";\n  const k = 1024;\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const value = bytes / Math.pow(k, i);\n  return `${value.toFixed(i === 0 ? 0 : 1)} ${sizes[i]}`;\n};\n\nconst isPdfFile = (file: File) =>\n  file.type === \"application/pdf\" || file.name.toLowerCase().endsWith(\".pdf\");\n\nconst isTextFile = (file: File) => {\n  const lower = file.name.toLowerCase();\n  return (\n    file.type.startsWith(\"text/\") ||\n    lower.endsWith(\".txt\") ||\n    lower.endsWith(\".md\") ||\n    lower.endsWith(\".csv\")\n  );\n};\n\nconst isImageFile = (file: File) => file.type.startsWith(\"image/\");\n\nexport default function Home() {\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const mindmapRequestRef = useRef<Promise<MindmapResponse | null> | null>(null);\n  const [backendBase, setBackendBase] = useState(INITIAL_BACKEND_BASE);\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [dragging, setDragging] = useState(false);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [isMindmapLoading, setIsMindmapLoading] = useState(false);\n  const [analysisResult, setAnalysisResult] = useState<AnalyzeResponse | null>(\n    null,\n  );\n  const [mindmapResult, setMindmapResult] = useState<MindmapResponse | null>(\n    null,\n  );\n  const [filePreviewUrl, setFilePreviewUrl] = useState<string | null>(null);\n  const [filePreviewType, setFilePreviewType] =\n    useState<FilePreviewKind>(\"none\");\n  const [filePreviewContent, setFilePreviewContent] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [mindmapError, setMindmapError] = useState<string | null>(null);\n  const [settingsOpen, setSettingsOpen] = useState(false);\n  const [apiKey, setApiKey] = useState(\"\");\n  const [llmBaseUrl, setLlmBaseUrl] = useState(DEFAULT_LLM_BASE_URL);\n  const [hasLoadedSettings, setHasLoadedSettings] = useState(false);\n  const [analysisCompleteMessage, setAnalysisCompleteMessage] =\n    useState<string | null>(null);\n  const [analysisProgress, setAnalysisProgress] = useState<\n    { value: number; message: string } | null\n  >(null);\n  const [isDownloading, setIsDownloading] = useState(false);\n  const fileInputId = useId();\n  const aggregatedKeywords = useMemo(() => {\n    if (!analysisResult) return [];\n    return Array.from(\n      new Set(\n        analysisResult.page_summaries\n          .map((page) => page.keywords.slice(0, 4))\n          .flat()\n          .filter((kw) => kw.trim().length > 0),\n      ),\n    ).slice(0, 24);\n  }, [analysisResult]);\n\n  const uploadHelpId = `${fileInputId}-help`;\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    setBackendBase(sanitizeBase(resolveBrowserBackendBase(rawBackendOrigin)));\n  }, []);\n\n  const toAbsoluteUrl = useCallback(\n    (url: string | null | undefined): string | null => {\n      if (!url) return null;\n      if (/^https?:\\/\\//i.test(url)) return url;\n      if (url.startsWith(\"/\")) return `${backendBase}${url}`;\n      return `${backendBase}/${url}`;\n    },\n    [backendBase],\n  );\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const storedKey = window.localStorage.getItem(\"autonote:llmApiKey\") ?? \"\";\n    const storedBase = window.localStorage.getItem(\"autonote:llmBaseUrl\");\n    setApiKey(storedKey);\n    setLlmBaseUrl(\n      storedBase && storedBase.trim().length > 0\n        ? storedBase\n        : DEFAULT_LLM_BASE_URL,\n    );\n    setHasLoadedSettings(true);\n  }, []);\n\n  useEffect(() => {\n    if (!hasLoadedSettings || typeof window === \"undefined\") return;\n    window.localStorage.setItem(\"autonote:llmApiKey\", apiKey);\n  }, [apiKey, hasLoadedSettings]);\n\n  useEffect(() => {\n    if (!hasLoadedSettings || typeof window === \"undefined\") return;\n    window.localStorage.setItem(\"autonote:llmBaseUrl\", llmBaseUrl);\n  }, [llmBaseUrl, hasLoadedSettings]);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return undefined;\n    if (!analysisCompleteMessage) return undefined;\n\n    const timer = window.setTimeout(() => {\n      setAnalysisCompleteMessage(null);\n    }, 4000);\n\n    return () => {\n      window.clearTimeout(timer);\n    };\n  }, [analysisCompleteMessage]);\n\n  useEffect(() => {\n    let objectUrl: string | null = null;\n    let cancelled = false;\n\n    if (!selectedFiles.length) {\n      setFilePreviewUrl(null);\n      setFilePreviewType(\"none\");\n      setFilePreviewContent(\"\");\n      return () => {\n        if (objectUrl) {\n          URL.revokeObjectURL(objectUrl);\n        }\n      };\n    }\n\n    const file = selectedFiles[0];\n\n    if (isPdfFile(file)) {\n      objectUrl = URL.createObjectURL(file);\n      if (!cancelled) {\n        setFilePreviewUrl(objectUrl);\n        setFilePreviewType(\"pdf\");\n        setFilePreviewContent(\"\");\n      }\n    } else if (isTextFile(file)) {\n      const reader = new FileReader();\n      reader.onload = () => {\n        if (!cancelled) {\n          setFilePreviewContent((reader.result as string) ?? \"\");\n          setFilePreviewUrl(null);\n          setFilePreviewType(\"text\");\n        }\n      };\n      reader.readAsText(file, \"utf-8\");\n    } else if (isImageFile(file)) {\n      objectUrl = URL.createObjectURL(file);\n      if (!cancelled) {\n        setFilePreviewUrl(objectUrl);\n        setFilePreviewType(\"image\");\n        setFilePreviewContent(\"\");\n      }\n    } else {\n      objectUrl = URL.createObjectURL(file);\n      if (!cancelled) {\n        setFilePreviewUrl(objectUrl);\n        setFilePreviewType(\"generic\");\n        setFilePreviewContent(\"\");\n      }\n    }\n\n    return () => {\n      cancelled = true;\n      if (objectUrl) {\n        URL.revokeObjectURL(objectUrl);\n      }\n    };\n  }, [selectedFiles]);\n\n  const handleFilesSelected = useCallback((files: FileList | File[]) => {\n    const fileArray = Array.from(files);\n    if (fileArray.length === 0) return;\n\n    if (fileArray.length > 1) {\n      setError(\"一次僅能上傳 1 個檔案，已保留第一個檔案。\");\n    } else {\n      setError(null);\n    }\n\n    const firstFile = fileArray[0];\n    if (!firstFile) return;\n\n    setSelectedFiles([firstFile]);\n    setMindmapError(null);\n    setAnalysisResult(null);\n    setMindmapResult(null);\n    setAnalysisCompleteMessage(null);\n    setAnalysisProgress(null);\n  }, []);\n\n  const handleDrop = useCallback(\n    (event: DragEvent<HTMLDivElement>) => {\n      event.preventDefault();\n      setDragging(false);\n      if (event.dataTransfer?.files) {\n        handleFilesSelected(event.dataTransfer.files);\n      }\n    },\n    [handleFilesSelected],\n  );\n\n  const handleDragOver = useCallback((event: DragEvent<HTMLDivElement>) => {\n    event.preventDefault();\n    setDragging(true);\n  }, []);\n\n  const handleDragLeave = useCallback(() => {\n    setDragging(false);\n  }, []);\n\n  const selectedFileName = selectedFiles[0]?.name ?? \"\";\n\n  const openPageSummaryViewer = useCallback(\n    (page: PageSummary) => {\n      if (!analysisResult) return;\n      try {\n        const payload = {\n          page_number: page.page_number,\n          classification: page.classification,\n          bullets: page.bullets,\n          keywords: page.keywords,\n          skipped: page.skipped,\n          skip_reason: page.skip_reason ?? null,\n          language: analysisResult.language,\n          total_pages: analysisResult.total_pages,\n          document_title: selectedFileName || null,\n        };\n        const params = new URLSearchParams({\n          data: JSON.stringify(payload),\n        });\n        params.set(\"viewer\", \"page\");\n        const viewerUrl = `/page-summary/viewer?${params.toString()}`;\n        window.open(viewerUrl, \"_blank\", \"noopener,noreferrer\");\n      } catch (err) {\n        console.error(\"開啟逐頁重點檢視器失敗\", err);\n      }\n    },\n    [analysisResult, selectedFileName],\n  );\n\n  const handleAnalyze = useCallback(async () => {\n    if (!selectedFiles.length) {\n      setError(\"請先選擇要上傳的檔案\");\n      return;\n    }\n    if (!apiKey.trim()) {\n      setError(\"請先於右上角設定 API Key\");\n      setSettingsOpen(true);\n      return;\n    }\n\n    setIsAnalyzing(true);\n    setAnalysisCompleteMessage(null);\n    setError(null);\n    setMindmapError(null);\n    setAnalysisProgress({ value: 5, message: \"準備分析…\" });\n\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", selectedFiles[0]);\n      formData.append(\"llm_api_key\", apiKey);\n      const cleanedBase = normalizeOptionalUrl(llmBaseUrl);\n      if (cleanedBase) {\n        formData.append(\"llm_base_url\", cleanedBase);\n      }\n\n      const analyzeEndpoint = `${backendBase}/analyze`;\n      const response = await fetch(analyzeEndpoint, {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok || !response.body) {\n        const text = await response.text();\n        throw new Error(text || \"分析失敗，請稍後再試\");\n      }\n\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let buffer = \"\";\n      let finalData: AnalyzeResponse | null = null;\n      let serverError: string | null = null;\n      let shouldStop = false;\n\n      const handleLine = (line: string) => {\n        if (!line) return;\n        try {\n          const event = JSON.parse(line) as {\n            type?: string;\n            progress?: number;\n            message?: string;\n            data?: AnalyzeResponse;\n          };\n\n          if (event.type === \"progress\") {\n            setAnalysisProgress({\n              value:\n                typeof event.progress === \"number\"\n                  ? Math.min(Math.max(event.progress, 0), 100)\n                  : 0,\n              message: event.message ?? \"\",\n            });\n          } else if (event.type === \"result\" && event.data) {\n            finalData = event.data;\n            setAnalysisProgress({\n              value:\n                typeof event.progress === \"number\"\n                  ? Math.min(Math.max(event.progress, 0), 100)\n                  : 100,\n              message: event.message ?? \"分析完成\",\n            });\n            shouldStop = true;\n          } else if (event.type === \"error\") {\n            serverError = event.message || \"分析失敗\";\n            setAnalysisProgress({ value: 100, message: serverError });\n            shouldStop = true;\n          }\n        } catch (err) {\n          console.error(\"無法解析伺服器訊息\", err, line);\n        }\n      };\n\n      while (true) {\n        const { value, done } = await reader.read();\n        if (value) {\n          buffer += decoder.decode(value, { stream: !done });\n          let newlineIndex = buffer.indexOf(\"\\n\");\n          while (newlineIndex >= 0) {\n            const line = buffer.slice(0, newlineIndex).trim();\n            buffer = buffer.slice(newlineIndex + 1);\n            handleLine(line);\n            newlineIndex = buffer.indexOf(\"\\n\");\n          }\n        }\n\n        if (done) {\n          const remaining = buffer.trim();\n          if (remaining) {\n            handleLine(remaining);\n          }\n          break;\n        }\n\n        if (shouldStop) {\n          // 嘗試讀完剩餘資料；若伺服器仍有內容會在下一輪完成。\n          if (!buffer.length) {\n            break;\n          }\n        }\n      }\n\n      if (serverError) {\n        throw new Error(serverError);\n      }\n\n      if (!finalData) {\n        throw new Error(\"未取得分析結果，請稍後再試\");\n      }\n\n      const resolvedData: AnalyzeResponse = finalData;\n\n      setAnalysisResult({\n        language: resolvedData.language,\n        total_pages: resolvedData.total_pages,\n        page_summaries: resolvedData.page_summaries,\n        global_summary: resolvedData.global_summary,\n        system_prompt: resolvedData.system_prompt,\n        wordcloud_image_url: toAbsoluteUrl(resolvedData.wordcloud_image_url),\n      });\n      setMindmapResult(null);\n      setAnalysisCompleteMessage(\"分析結果已完成\");\n      window.setTimeout(() => setAnalysisProgress(null), 1200);\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"分析時發生未知錯誤\";\n      setError(message);\n      setAnalysisResult(null);\n      setMindmapResult(null);\n      setAnalysisCompleteMessage(null);\n      setAnalysisProgress(null);\n    } finally {\n      setIsAnalyzing(false);\n    }\n  }, [selectedFiles, apiKey, llmBaseUrl, backendBase, toAbsoluteUrl]);\n\n  const ensureMindmap = useCallback(\n    async (options?: { silent?: boolean }): Promise<MindmapResponse | null> => {\n      if (mindmapResult) {\n        return mindmapResult;\n      }\n\n      if (!selectedFiles.length) {\n        if (!options?.silent) {\n          setMindmapError(\"請先選擇檔案\");\n        }\n        return null;\n      }\n\n      if (mindmapRequestRef.current) {\n        return mindmapRequestRef.current;\n      }\n\n      const fetchPromise = (async () => {\n        setMindmapError(null);\n        setIsMindmapLoading(true);\n\n        try {\n          const formData = new FormData();\n          formData.append(\"file\", selectedFiles[0]);\n          if (apiKey.trim()) {\n            formData.append(\"llm_api_key\", apiKey);\n          }\n          const cleanedBase = normalizeOptionalUrl(llmBaseUrl);\n          if (cleanedBase) {\n            formData.append(\"llm_base_url\", cleanedBase);\n          }\n\n          const mindmapEndpoint = `${backendBase}/mindmap`;\n          const response = await fetch(mindmapEndpoint, {\n            method: \"POST\",\n            body: formData,\n          });\n\n          if (!response.ok) {\n            const text = await response.text();\n            throw new Error(text || \"心智圖生成失敗\");\n          }\n\n          const data = (await response.json()) as MindmapResponse;\n          const normalized: MindmapResponse = {\n            ...data,\n            mindmap_file_url: toAbsoluteUrl(data.mindmap_file_url),\n            mindmap_image_url: toAbsoluteUrl(data.mindmap_image_url),\n            source_upload_url: toAbsoluteUrl(data.source_upload_url),\n          };\n          setMindmapResult(normalized);\n          return normalized;\n        } catch (err) {\n          const message =\n            err instanceof Error ? err.message : \"心智圖生成時發生未知錯誤\";\n          if (!options?.silent) {\n            setMindmapError(message);\n          }\n          setMindmapResult(null);\n          return null;\n        } finally {\n          setIsMindmapLoading(false);\n          mindmapRequestRef.current = null;\n        }\n      })();\n\n      mindmapRequestRef.current = fetchPromise;\n      return fetchPromise;\n    },\n    [mindmapResult, selectedFiles, apiKey, llmBaseUrl, backendBase, toAbsoluteUrl],\n  );\n\n  const resetSelection = useCallback(() => {\n    setSelectedFiles([]);\n    setAnalysisResult(null);\n    setMindmapResult(null);\n    setError(null);\n    setMindmapError(null);\n    setAnalysisCompleteMessage(null);\n    setAnalysisProgress(null);\n  }, []);\n\n  const handleDownloadReport = useCallback(async () => {\n    if (!analysisResult) {\n      setError(\"請先完成檔案分析後再下載報告\");\n      return;\n    }\n\n    setIsDownloading(true);\n\n    try {\n      const languageLabel = analysisResult.language\n        ? analysisResult.language.toUpperCase()\n        : null;\n\n      let mindmapData = mindmapResult;\n      if (!mindmapData) {\n        mindmapData = await ensureMindmap();\n      }\n\n      const pdfFontUrl = toAbsoluteUrl(\"/assets/fonts/Noto_Sans_TC/NotoSansTC-VariableFont_wght.ttf\");\n\n      const pdfBytes = await generateAnalysisPdf({\n        documentTitle: selectedFileName || \"未命名檔案\",\n        languageLabel,\n        totalPages: analysisResult.total_pages,\n        globalSummary: analysisResult.global_summary,\n        aggregatedKeywords,\n        pageSummaries: analysisResult.page_summaries,\n        wordcloudUrl: analysisResult.wordcloud_image_url ?? undefined,\n        mindmapImageUrl: mindmapData?.mindmap_image_url ?? undefined,\n        fontUrl: pdfFontUrl ?? undefined,\n      });\n\n      const arrayBuffer = pdfBytes.buffer.slice(\n        pdfBytes.byteOffset,\n        pdfBytes.byteOffset + pdfBytes.byteLength,\n      );\n      const blob = new Blob([arrayBuffer as ArrayBuffer], { type: \"application/pdf\" });\n      const downloadUrl = URL.createObjectURL(blob);\n      const anchor = document.createElement(\"a\");\n      const baseName = (selectedFileName || \"分析報告\")\n        .replace(/\\\\.[^\\\\.]+$/, \"\")\n        .replace(/[\\\\\\\\/:*?\"<>|]/g, \"_\");\n      anchor.href = downloadUrl;\n      anchor.download = `${baseName || \"分析報告\"}-分析結果.pdf`;\n      document.body.appendChild(anchor);\n      anchor.click();\n      document.body.removeChild(anchor);\n      URL.revokeObjectURL(downloadUrl);\n    } catch (err) {\n      console.error(\"生成 PDF 失敗\", err);\n      const message =\n        err instanceof Error ? err.message : \"PDF 生成時發生未知錯誤\";\n      setError(message);\n    } finally {\n      setIsDownloading(false);\n    }\n  }, [\n    analysisResult,\n    aggregatedKeywords,\n    ensureMindmap,\n    mindmapResult,\n    selectedFileName,\n    toAbsoluteUrl,\n  ]);\n\n  const renderMindmap = () => {\n    if (mindmapError) {\n      return <p className=\"text-rose-500\">{mindmapError}</p>;\n    }\n\n    if (isMindmapLoading) {\n      return <p className=\"text-slate-500\">心智圖生成中，請稍候…</p>;\n    }\n\n    if (!mindmapResult) {\n      return (\n        <p className=\"text-slate-500\">\n          點擊下方「心智圖生成」後，將於此顯示自動生成的圖像與摘要。\n        </p>\n      );\n    }\n\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <h3 className=\"text-lg font-semibold text-slate-800\">\n            {mindmapResult.doc_title || \"心智圖\"}\n          </h3>\n          <p className=\"mt-2 text-sm text-slate-500\">\n            語言：{mindmapResult.language.toUpperCase()}\n          </p>\n        </div>\n        {mindmapResult.mindmap_image_url ? (\n          <div className=\"space-y-4\">\n            <div className=\"overflow-hidden rounded-2xl border border-slate-200 bg-white\">\n              <div className=\"relative aspect-[16/10] w-full\">\n                <Image\n                  src={mindmapResult.mindmap_image_url}\n                  alt=\"心智圖預覽\"\n                  fill\n                  className=\"object-contain\"\n                  unoptimized\n                />\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  if (!mindmapResult?.mindmap_image_url) return;\n                  const params = new URLSearchParams({\n                    image: mindmapResult.mindmap_image_url,\n                    viewer: \"mindmap\",\n                  });\n                  if (mindmapResult.doc_title) {\n                    params.set(\"title\", mindmapResult.doc_title);\n                  }\n                  if (mindmapResult.language) {\n                    params.set(\"lang\", mindmapResult.language);\n                  }\n                  if (mindmapResult.mindmap_file_url) {\n                    params.set(\"file\", mindmapResult.mindmap_file_url);\n                  }\n                  const viewerUrl = `/mindmap/viewer?${params.toString()}`;\n                  window.open(viewerUrl, \"_blank\", \"noopener,noreferrer\");\n                }}\n                className=\"inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-slate-400 hover:text-slate-800\"\n              >\n                放大查看\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"1.5\"\n                  className=\"h-4 w-4\"\n                >\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 10h4.5M19.5 10V5.5M5 19l5.5-5.5M5 19v-4.5\" />\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4.5 9v-2a2.5 2.5 0 0 1 2.5-2.5h2M19.5 15v2a2.5 2.5 0 0 1-2.5 2.5h-2\" />\n                </svg>\n              </button>\n            </div>\n          </div>\n        ) : (\n          <p className=\"text-slate-500\">暫無心智圖圖片可預覽。</p>\n        )}\n      </div>\n    );\n  };\n\n  const renderUploadPreview = () => {\n    if (!selectedFiles.length) {\n      return (\n        <div className=\"flex h-full items-center justify-center rounded-2xl border border-dashed border-slate-200 bg-white/70 p-6 text-sm text-slate-500\">\n          上傳檔案後即可在此預覽原始內容。\n        </div>\n      );\n    }\n\n    if (filePreviewType === \"pdf\" && filePreviewUrl) {\n      return (\n        <iframe\n          title=\"檔案預覽\"\n          src={filePreviewUrl}\n          className=\"h-full w-full rounded-2xl border border-slate-200 bg-white\"\n        />\n      );\n    }\n\n    if (filePreviewType === \"image\" && filePreviewUrl) {\n      return (\n        <div className=\"relative h-full w-full overflow-hidden rounded-2xl border border-slate-200 bg-white\">\n          <Image\n            src={filePreviewUrl}\n            alt=\"選擇的圖片預覽\"\n            fill\n            className=\"object-contain\"\n            unoptimized\n          />\n        </div>\n      );\n    }\n\n    if (filePreviewType === \"text\") {\n      return (\n        <div className=\"h-full overflow-y-auto rounded-2xl border border-slate-200 bg-white/90 p-4\">\n          <pre className=\"whitespace-pre-wrap text-sm leading-6 text-slate-700\">\n            {filePreviewContent}\n          </pre>\n        </div>\n      );\n    }\n\n    if (filePreviewType === \"generic\" && filePreviewUrl) {\n      return (\n        <iframe\n          title=\"檔案預覽\"\n          src={filePreviewUrl}\n          className=\"h-full w-full rounded-2xl border border-slate-200 bg-white\"\n        />\n      );\n    }\n\n    return (\n      <div className=\"flex h-full items-center justify-center rounded-2xl border border-dashed border-slate-200 bg-white/70 p-6 text-sm text-slate-500\">\n        此檔案格式暫不支援內嵌預覽，請重新選擇其他檔案。\n      </div>\n    );\n  };\n\n  const renderMindmapSection = () => {\n    if (!analysisResult) return null;\n\n    return (\n      <section className=\"space-y-6 rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-inner\">\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n          <div>\n            <h3 className=\"text-xl font-semibold text-slate-900\">心智圖生成（選用）</h3>\n            <p className=\"text-sm text-slate-500\">\n              產生視覺化架構以輔助簡報或教學，可重覆點選更新內容。\n            </p>\n          </div>\n          <button\n            type=\"button\"\n            onClick={() => void ensureMindmap()}\n            disabled={isMindmapLoading || !selectedFiles.length}\n            className={`inline-flex items-center justify-center rounded-full px-5 py-2 text-sm font-medium transition ${\n              isMindmapLoading || !selectedFiles.length\n                ? \"cursor-not-allowed border border-slate-200 bg-slate-100 text-slate-400\"\n                : \"border border-slate-200 bg-white text-slate-700 hover:border-indigo-200 hover:text-indigo-600\"\n            }`}\n          >\n            {isMindmapLoading ? \"心智圖生成中…\" : \"生成心智圖\"}\n          </button>\n        </div>\n        {renderMindmap()}\n      </section>\n    );\n  };\n\n  const renderAnalysisPanel = () => {\n    if (!analysisResult) {\n      return (\n        <div className=\"flex min-h-[240px] items-center justify-center rounded-3xl border border-dashed border-slate-200 bg-white/80 p-8 text-sm text-slate-500\">\n          完成檔案分析後，全局摘要、逐頁重點與心智圖將顯示於此處。\n        </div>\n      );\n    }\n\n    const languageLabel = analysisResult.language\n      ? analysisResult.language.toUpperCase()\n      : \"\";\n\n    const classificationMap: Record<string, string> = {\n      normal: \"一般內容\",\n      toc: \"目錄頁\",\n      pure_image: \"純圖片\",\n      blank: \"空白/水印\",\n      cover: \"封面\",\n    };\n\n    return (\n      <div className=\"space-y-8\">\n        <section className=\"space-y-6 rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-inner\">\n          <div className=\"flex flex-wrap items-center gap-3 text-sm text-slate-500\">\n            {languageLabel ? (\n              <span className=\"rounded-full bg-slate-100 px-3 py-1 font-medium text-slate-600\">\n                語言：{languageLabel}\n              </span>\n            ) : null}\n            <span className=\"rounded-full bg-emerald-50 px-3 py-1 font-medium text-emerald-600\">\n              共 {analysisResult.total_pages} 頁\n            </span>\n          </div>\n          <div className=\"space-y-6\">\n            <div>\n              <h3 className=\"text-lg font-semibold text-slate-800\">全局總結</h3>\n              {analysisResult.global_summary.bullets.length ? (\n                <ul className=\"mt-4 space-y-3 text-[15px] leading-7 text-slate-800\">\n                  {analysisResult.global_summary.bullets.map((item, index) => (\n                    <li\n                      key={`${item}-${index}`}\n                      className=\"rounded-xl border border-slate-200 bg-slate-50/80 px-4 py-3\"\n                    >\n                      {item}\n                    </li>\n                  ))}\n                </ul>\n              ) : (\n                <p className=\"mt-3 text-slate-500\">尚未取得全局摘要。</p>\n              )}\n            </div>\n            <div className=\"grid gap-6 lg:grid-cols-3\">\n              <article className=\"rounded-2xl border border-slate-200 bg-white/80 p-5 shadow-sm\">\n                <h4 className=\"text-sm font-semibold text-slate-600\">關鍵結論</h4>\n                <p className=\"mt-3 text-sm leading-7 text-slate-700\">\n                  {analysisResult.global_summary.expansions.key_conclusions || \"暫無資料\"}\n                </p>\n              </article>\n              <article className=\"rounded-2xl border border-slate-200 bg-white/80 p-5 shadow-sm\">\n                <h4 className=\"text-sm font-semibold text-slate-600\">核心數據與依據</h4>\n                <p className=\"mt-3 text-sm leading-7 text-slate-700\">\n                  {analysisResult.global_summary.expansions.core_data || \"暫無資料\"}\n                </p>\n              </article>\n              <article className=\"rounded-2xl border border-slate-200 bg-white/80 p-5 shadow-sm\">\n                <h4 className=\"text-sm font-semibold text-slate-600\">風險與建議</h4>\n                <p className=\"mt-3 text-sm leading-7 text-slate-700\">\n                  {analysisResult.global_summary.expansions.risks_and_actions || \"暫無資料\"}\n                </p>\n              </article>\n            </div>\n          </div>\n          <div className=\"grid gap-6 lg:grid-cols-[2fr_1fr]\">\n            <div className=\"rounded-2xl border border-slate-200 bg-white/90 p-5\">\n              <h4 className=\"text-sm font-semibold text-slate-600\">整體關鍵字</h4>\n              {aggregatedKeywords.length ? (\n                <div className=\"mt-3 flex flex-wrap gap-2\">\n                  {aggregatedKeywords.map((kw) => (\n                    <span\n                      key={kw}\n                      className=\"rounded-full bg-indigo-50 px-3 py-1 text-sm font-medium text-indigo-600\"\n                    >\n                      {kw}\n                    </span>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"mt-3 text-sm text-slate-500\">暫無關鍵字可顯示。</p>\n              )}\n            </div>\n            <div className=\"rounded-2xl border border-slate-200 bg-white/90 p-5\">\n              <h4 className=\"text-sm font-semibold text-slate-600\">文字雲</h4>\n              {analysisResult.wordcloud_image_url ? (\n                <div className=\"space-y-3\">\n                  <div className=\"relative aspect-[4/3] w-full overflow-hidden rounded-xl border border-slate-200\">\n                    <Image\n                      src={analysisResult.wordcloud_image_url}\n                      alt=\"關鍵字文字雲\"\n                      fill\n                      className=\"object-contain\"\n                      unoptimized\n                    />\n                  </div>\n                  <div className=\"text-right\">\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        if (!analysisResult.wordcloud_image_url) return;\n                        const params = new URLSearchParams({\n                          image: analysisResult.wordcloud_image_url,\n                          viewer: \"wordcloud\",\n                          title: \"文字雲\",\n                        });\n                        if (analysisResult.language) {\n                          params.set(\"lang\", analysisResult.language);\n                        }\n                        const viewerUrl = `/mindmap/viewer?${params.toString()}`;\n                        window.open(viewerUrl, \"_blank\", \"noopener,noreferrer\");\n                      }}\n                      className=\"inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-slate-400 hover:text-slate-800\"\n                    >\n                      放大查看\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        viewBox=\"0 0 24 24\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        strokeWidth=\"1.5\"\n                        className=\"h-4 w-4\"\n                      >\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 10h4.5M19.5 10V5.5M5 19l5.5-5.5M5 19v-4.5\" />\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4.5 9v-2a2.5 2.5 0 0 1 2.5-2.5h2M19.5 15v2a2.5 2.5 0 0 1-2.5 2.5h-2\" />\n                      </svg>\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <p className=\"mt-3 text-sm text-slate-500\">尚未取得文字雲。</p>\n              )}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"space-y-5 rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-inner\">\n          <h3 className=\"text-lg font-semibold text-slate-800\">逐頁重點與關鍵字</h3>\n          <div className=\"space-y-5 max-h-[520px] overflow-y-auto pr-2\">\n            {analysisResult.page_summaries.map((page) => (\n              <article\n                key={page.page_number}\n                className=\"rounded-2xl border border-slate-200 bg-white/90 p-5 shadow-sm\"\n              >\n                <div className=\"flex flex-wrap items-center justify-between gap-3\">\n                  <div className=\"flex flex-wrap items-center gap-2\">\n                    <span className=\"text-sm font-semibold text-slate-700\">\n                      第 {page.page_number} 頁\n                    </span>\n                    <span className=\"rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-medium text-slate-600\">\n                      {classificationMap[page.classification] ?? page.classification}\n                    </span>\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => openPageSummaryViewer(page)}\n                    className=\"inline-flex items-center gap-2 rounded-full border border-slate-300 px-3 py-1.5 text-xs font-medium text-slate-600 transition hover:border-slate-400 hover:text-slate-800\"\n                  >\n                    放大查看\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      viewBox=\"0 0 24 24\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"1.5\"\n                      className=\"h-3.5 w-3.5\"\n                    >\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 10h4.5M19.5 10V5.5M5 19l5.5-5.5M5 19v-4.5\" />\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4.5 9v-2a2.5 2.5 0 0 1 2.5-2.5h2M19.5 15v2a2.5 2.5 0 0 1-2.5 2.5h-2\" />\n                    </svg>\n                  </button>\n                </div>\n                <ul className=\"mt-3 space-y-2 text-sm leading-7 text-slate-700\">\n                  {page.bullets.map((bullet, idx) => (\n                    <li key={`${page.page_number}-${idx}`} className=\"rounded-xl bg-slate-50/80 px-3 py-2\">\n                      {bullet}\n                    </li>\n                  ))}\n                </ul>\n                {page.keywords.length ? (\n                  <div className=\"mt-3 flex flex-wrap gap-2 text-xs\">\n                    {page.keywords.map((kw) => (\n                      <span\n                        key={`${page.page_number}-${kw}`}\n                        className=\"rounded-full bg-emerald-50 px-2.5 py-1 text-xs font-medium text-emerald-600\"\n                      >\n                        {kw}\n                      </span>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"mt-3 text-xs text-slate-400\">本頁尚無關鍵字。</p>\n                )}\n                {page.skipped && page.skip_reason ? (\n                  <p className=\"mt-3 text-xs text-slate-500\">原因：{page.skip_reason}</p>\n                ) : null}\n              </article>\n            ))}\n          </div>\n        </section>\n\n        {renderMindmapSection()}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-[#f6f8ff] via-[#f4f7fb] to-[#edf1ff] text-slate-900\">\n      {analysisCompleteMessage ? (\n        <div className=\"fixed right-6 top-6 z-50 rounded-2xl border border-emerald-200 bg-emerald-50 px-5 py-3 text-sm font-semibold text-emerald-700 shadow-lg\">\n          {analysisCompleteMessage}\n        </div>\n      ) : null}\n      <header className=\"grid grid-cols-[1fr_auto_1fr] items-center px-8 pt-8\">\n        <div aria-hidden />\n        <div className=\"col-start-2 col-end-3 flex items-center justify-center gap-4\">\n          <div className=\"flex h-12 w-12 items-center justify-center rounded-2xl bg-gradient-to-br from-indigo-500 via-purple-500 to-blue-500 text-2xl text-white shadow-lg\">\n            📄\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xl font-semibold text-slate-900\">AutoNote & Slide</p>\n            <p className=\"text-sm text-slate-500\">智慧文檔處理平台</p>\n          </div>\n        </div>\n        <button\n          type=\"button\"\n          onClick={() => setSettingsOpen(true)}\n          className=\"group col-start-3 col-end-4 justify-self-end rounded-2xl border border-white/60 bg-white/80 p-3 shadow-lg transition hover:shadow-xl\"\n          aria-label=\"開啟 API 設定\"\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"1.6\"\n            className=\"h-6 w-6 text-slate-600 transition group-hover:text-slate-900\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M10.325 4.317a1 1 0 0 1 .894-.553h1.562a1 1 0 0 1 .894.553l.482.964a1 1 0 0 0 .764.553l1.064.12a1 1 0 0 1 .874.874l.12 1.064a1 1 0 0 0 .553.764l.964.482a1 1 0 0 1 .553.894v1.562a1 1 0 0 1-.553.894l-.964.482a1 1 0 0 0-.553.764l-.12 1.064a1 1 0 0 1-.874.874l-1.064.12a1 1 0 0 0-.764.553l-.482.964a1 1 0 0 1-.894.553h-1.562a1 1 0 0 1-.894-.553l-.482-.964a1 1 0 0 0-.764-.553l-1.064-.12a1 1 0 0 1-.874-.874l-.12-1.064a1 1 0 0 0-.553-.764l-.964-.482a1 1 0 0 1-.553-.894v-1.562a1 1 0 0 1 .553-.894l.964-.482a1 1 0 0 0 .553-.764l.12-1.064a1 1 0 0 1 .874-.874l1.064-.12a1 1 0 0 0 .764-.553l.482-.964Z\"\n            />\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\n            />\n          </svg>\n        </button>\n      </header>\n\n      <main className=\"mx-auto mt-8 max-w-[1400px] px-8 pb-20 lg:px-10\">\n        <div className=\"rounded-3xl border border-amber-100 bg-gradient-to-r from-amber-50 to-amber-100/70 px-8 py-5 text-sm font-medium text-amber-800 shadow-sm text-center lg:text-base\">\n          目前僅支援電腦端使用，請使用電腦瀏覽器獲得最佳體驗\n        </div>\n\n        <div className=\"mt-10 space-y-10\">\n          <div className=\"grid grid-cols-1 gap-10 xl:grid-cols-2 xl:items-stretch\">\n          <section className=\"relative flex w-full flex-col rounded-[40px] border border-white/60 bg-white/95 p-10 shadow-2xl lg:min-h-[620px] xl:min-h-[700px]\">\n            <div className=\"mt-10 flex flex-1 flex-col items-center gap-6 text-center\">\n              <div\n                className={`flex min-h-[420px] w-full flex-col items-center justify-center gap-6 rounded-3xl border-2 border-dashed bg-gradient-to-br from-slate-50 to-slate-100/70 p-10 transition ${dragging ? \"border-indigo-400 bg-indigo-50/70\" : \"border-slate-200\"}`}\n                onDragOver={handleDragOver}\n                onDragLeave={handleDragLeave}\n                onDrop={handleDrop}\n              >\n                <label htmlFor={fileInputId} className=\"sr-only\">\n                  選擇要分析的檔案\n                </label>\n                <input\n                  id={fileInputId}\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\".pdf,.ppt,.pptx,.doc,.docx,.md,.txt\"\n                  className=\"sr-only\"\n                  aria-describedby={uploadHelpId}\n                  onChange={(event) => {\n                    if (event.target.files) {\n                      handleFilesSelected(event.target.files);\n                    }\n                  }}\n                />\n                <div className=\"flex h-28 w-28 items-center justify-center rounded-[36px] bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500 text-4xl text-white shadow-xl\">\n                  ⬆️\n                </div>\n                <div className=\"flex max-w-xl flex-col gap-3\">\n                  <h1 className=\"text-3xl font-semibold text-slate-900\">上傳您的檔案</h1>\n                  <p className=\"text-base leading-7 text-slate-600\">\n                    將檔案拖放到此處，或點擊任何地方瀏覽檔案。上傳後系統會整理每頁重點並彙整全局摘要。\n                  </p>\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"rounded-full bg-slate-900 px-6 py-2 text-sm font-medium text-white shadow-lg transition hover:bg-slate-700\"\n                >\n                  選擇檔案\n                </button>\n                <p id={uploadHelpId} className=\"text-xs leading-6 text-slate-500\">\n                  支援格式：PDF · PPT · PPTX · Word · Markdown · TXT\n                  <br />\n                  最大檔案大小：50MB，一次僅能上傳 1 份檔案\n                </p>\n                <div className=\"flex flex-wrap justify-center gap-3 text-sm font-medium\">\n                  {fileTypes.map((type) => (\n                    <span\n                      key={type.label}\n                      className={`${type.color} rounded-full bg-white px-3 py-1 shadow-sm`}\n                    >\n                      {type.label}\n                    </span>\n                  ))}\n                </div>\n              </div>\n\n              {selectedFiles.length > 0 ? (\n                <div className=\"w-full rounded-2xl border border-slate-200 bg-slate-50/80 p-4 text-left text-sm text-slate-600\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium text-slate-800\">已選擇檔案</p>\n                      <p className=\"mt-1 text-sm text-slate-600\">{selectedFileName}</p>\n                      <p className=\"mt-1 text-xs text-slate-500\">\n                        檔案大小：{formatBytes(selectedFiles[0].size)}\n                      </p>\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={resetSelection}\n                      className=\"text-xs font-medium text-rose-500 hover:text-rose-600\"\n                    >\n                      重新選擇\n                    </button>\n                  </div>\n                </div>\n              ) : null}\n\n              {error ? (\n                <div className=\"w-full rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600\">\n                  {error}\n                </div>\n              ) : null}\n\n              {analysisProgress ? (\n                <div className=\"w-full space-y-2 text-left\">\n                  <div className=\"flex items-center justify-between text-xs text-slate-500\">\n                    <span>{analysisProgress.message || \"分析中\"}</span>\n                    <span>{analysisProgress.value}%</span>\n                  </div>\n                  <div className=\"h-2 w-full rounded-full bg-slate-200\">\n                    <div\n                      className=\"h-full rounded-full bg-gradient-to-r from-indigo-500 to-blue-500 transition-all\"\n                      style={{ width: `${Math.min(Math.max(analysisProgress.value, 0), 100)}%` }}\n                    />\n                  </div>\n                </div>\n              ) : null}\n\n              <button\n                type=\"button\"\n                onClick={handleAnalyze}\n                disabled={isAnalyzing}\n                className=\"mt-auto inline-flex w-full items-center justify-center rounded-2xl bg-gradient-to-r from-indigo-500 to-blue-500 px-6 py-3 text-base font-semibold text-white shadow-lg transition hover:from-indigo-600 hover:to-blue-600 disabled:cursor-not-allowed disabled:opacity-60\"\n              >\n                {isAnalyzing ? \"分析中…\" : \"開始分析\"}\n              </button>\n            </div>\n          </section>\n\n          <section className=\"relative flex w-full flex-col rounded-[40px] border border-white/60 bg-white/95 p-10 shadow-2xl lg:min-h-[620px] xl:min-h-[700px]\">\n            <div className=\"flex flex-col items-center gap-4 text-center\">\n              <div>\n                <h2 className=\"text-3xl font-semibold text-slate-900\">檔案預覽</h2>\n                <p className=\"mt-3 text-base text-slate-600\">\n                  左側上傳檔案後，可在此預覽原始檔案內容。\n                </p>\n              </div>\n            </div>\n            <div className=\"mt-6 flex-1 overflow-hidden rounded-[28px] bg-slate-50/90 p-4\">\n              <div className=\"h-full w-full\">{renderUploadPreview()}</div>\n            </div>\n          </section>\n          </div>\n\n          <section className=\"relative w-full rounded-[40px] border border-white/60 bg-white/95 p-10 shadow-2xl\">\n            <div className=\"flex flex-col gap-4 text-center lg:flex-row lg:items-center lg:justify-between\">\n              <div className=\"lg:text-left\">\n                <h2 className=\"text-3xl font-semibold text-slate-900\">分析結果整理</h2>\n                <p className=\"mt-3 text-base text-slate-600\">\n                  檔案分析完成後，全局摘要、逐頁重點與心智圖會集中顯示在此區域。\n                </p>\n              </div>\n              <div className=\"flex flex-col items-center gap-2 lg:items-end\">\n                <button\n                  type=\"button\"\n                  onClick={() => void handleDownloadReport()}\n                  disabled={!analysisResult || isDownloading || isAnalyzing}\n                  className={`inline-flex items-center gap-2 rounded-full px-5 py-2 text-sm font-medium transition ${\n                    !analysisResult || isDownloading || isAnalyzing\n                      ? \"cursor-not-allowed border border-slate-200 bg-slate-100 text-slate-400\"\n                      : \"border border-emerald-200 bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg hover:from-emerald-600 hover:to-teal-600\"\n                  }`}\n                >\n                  {isDownloading ? \"PDF 準備中…\" : \"下載 PDF 報告\"}\n                  {!isDownloading ? (\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      viewBox=\"0 0 24 24\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"1.5\"\n                      className=\"h-4 w-4\"\n                    >\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 16.5V18a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-1.5\" />\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 5v11m0 0-3.5-3.5M12 16l3.5-3.5\" />\n                    </svg>\n                  ) : null}\n                </button>\n                <p className=\"text-xs text-slate-400\">PDF 將包含摘要、關鍵字、文字雲與心智圖</p>\n              </div>\n            </div>\n            <div className=\"mt-6\">{renderAnalysisPanel()}</div>\n          </section>\n        </div>\n      </main>\n\n      {settingsOpen ? (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/30 px-4\">\n          <div className=\"w-full max-w-md rounded-3xl border border-white/60 bg-white/95 p-6 shadow-2xl\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-lg font-semibold text-slate-900\">API 設定</h3>\n                <p className=\"text-sm text-slate-500\">請輸入您的 LLM API Key 與 Base URL</p>\n              </div>\n              <button\n                type=\"button\"\n                onClick={() => setSettingsOpen(false)}\n                className=\"rounded-full p-2 text-slate-400 transition hover:bg-slate-100 hover:text-slate-600\"\n                aria-label=\"關閉設定\"\n              >\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"1.8\"\n                  className=\"h-5 w-5\"\n                >\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"m6 6 12 12M18 6 6 18\" />\n                </svg>\n              </button>\n            </div>\n            <div className=\"mt-6 space-y-5\">\n              <div>\n                <label className=\"text-sm font-medium text-slate-700\" htmlFor=\"apiKey\">\n                  API Key\n                </label>\n                <input\n                  id=\"apiKey\"\n                  type=\"password\"\n                  value={apiKey}\n                  onChange={(event) => setApiKey(event.target.value)}\n                  placeholder=\"請輸入您的 API Key\"\n                  className=\"mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-inner focus:border-indigo-400 focus:outline-none\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-slate-700\" htmlFor=\"llmBaseUrlInput\">\n                  base url（可選填）\n                </label>\n                <input\n                  id=\"llmBaseUrlInput\"\n                  type=\"url\"\n                  value={llmBaseUrl}\n                  onChange={(event) => setLlmBaseUrl(event.target.value)}\n                  placeholder=\"https://api.openai.com/v1\"\n                  className=\"mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-inner focus:border-indigo-400 focus:outline-none\"\n                />\n                <p className=\"mt-2 text-xs text-slate-400\">\n                  若未填寫將沿用預設 base url：https://api.openai.com/v1。\n                </p>\n              </div>\n            </div>\n            <div className=\"mt-6 flex justify-end gap-3\">\n              <button\n                type=\"button\"\n                onClick={() => setSettingsOpen(false)}\n                className=\"rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100\"\n              >\n                取消\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setSettingsOpen(false)}\n                className=\"rounded-xl bg-indigo-500 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-600\"\n              >\n                確認\n              </button>\n            </div>\n          </div>\n        </div>\n      ) : null}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}